<!DOCTYPE html>
<html>
<head>
    <title>Mac OS 9 Chat</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="mac-window">
        <div class="title-bar">
            <div class="close-box" id="exitBtn" title="Close & Email Transcript"></div>
            <div class="title-lines"></div>
            <span class="title-text">Chat Messenger</span>
            <div class="title-lines"></div>
        </div>
        
        <div id="chat-content"></div>

        <div class="input-panel">
            <input id="userName" placeholder="Name..." class="mac-input">
            <input id="msgInput" placeholder="Enter message" class="mac-input">
            <label for="imgUpload" class="mac-btn">ðŸ“·</label>
            <input type="file" id="imgUpload" accept="image/*" style="display:none">
            <button class="mac-btn" onclick="send()">Send</button>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();

        function send() {
            const user = document.getElementById('userName').value || 'Guest';
            const text = document.getElementById('msgInput').value;
            const file = document.getElementById('imgUpload').files[0];

            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    socket.emit('chat message', { user, text, img: e.target.result });
                };
                reader.readAsDataURL(file);
            } else if (text) {
                socket.emit('chat message', { user, text });
            }
            
            document.getElementById('msgInput').value = '';
            document.getElementById('imgUpload').value = '';
        }

        socket.on('chat message', (data) => {
            const div = document.createElement('div');
            div.className = 'message';
            div.innerHTML = `<strong>${data.user}:</strong> ${data.text}`;
            if (data.img) {
                div.innerHTML += `<br><img src="${data.img}" class="chat-img">`;
            }
            document.getElementById('chat-content').appendChild(div);
            div.scrollIntoView();
        });

        document.getElementById('exitBtn').onclick = () => {
            if(confirm("Exit and email the transcript?")) {
                socket.emit('end-session');
                alert("Session closed. Transcript sent.");
            }
        };
    </script>
</body>
</html>
